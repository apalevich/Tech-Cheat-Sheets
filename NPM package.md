Тема пакетов для Node.js — довольно обширная и зависит от конкретного кейса. Ниже я структурирую информацию по теме так, чтобы было удобно пропускать части, которые неактуальны в том или ином случае.

# Подготовка
[Node.js](Node.js) — это среда, которая позволяет запускать код на языке JavaScript на сервере или компьютере.
**NPM** — это менеджер пакетов Node.js, который позволяет создавать, устанавливать и использовать пакеты на уровне отдельных пакетов или всей системы

Для создания и публикации пакета понадобятся установленные Node.js и NPM.
Остальные требования будут разобраны ниже.

# Что есть NPM пакет

NPM пакет — это файл или директория с файлами, описанный файлом `package.json` в его корне. NPM пакеты могут распространяться через реестры (например, NPM registry), репозитории или как папки/файлы/архивы.

После установки в проект пакет становится **модулем** — это значит, что он находится в папке `node_modules` в корне проекта и доступен через функцию Node.js `require()`.

Однако, модули могут быть нет пакетами, а исполняемыми JavaScript-файл. Тогда они лежат в `node_modules/.bin` и запускаются через `npx [packagename] [args]`

Пакет также можно установить глобально. Тогда он будет лежать не в `node_modules`, а по пути, указанному по команде `node root -g`. Так лучше устанавливать только CLI-приложения: `npm`, `vue-cli`, `create-react-app` и похожие

## package.json

`package.json` — файл, в котором описана вся информация о пакете и как с ним работать:
- другие пакеты, от которых зависит его работа
- информация для воспроизведения пакеты на другом устройстве (инструкция сборки, тестирования и тп.)
- версия этого пакета, описание, контакты автора

Файл может быть создан через команду `npm init` или вручную. Главное — чтобы он находился в корне пакета.

### Поля

В package.json нет обязательных полей и он может быть пустым объектом: `{}`

Однако, есть поля, обязательные при распространении через NPM registry (далее — просто npm)

`name` — имя пакета. Указывается самостоятельно (`package-name`) или внутри области видимости — `@company/package-name`). Не более 214 символов, только строчные буквы, без пробелов

`version` — обязательно в формате [семантического версионирования](https://semver.org/), то есть X.Y.Z, где:
- X — мажорная версия, которая может быть несовместима с предыдущей
- Y — минорная версия, которая совместима с предыдущей
- Z — патч, который совместим с предудещей версией, исправляя баги в ней

Также считается хорошей практикой указывать для дистрибуции:

`description` — описание простой строкой. Используется для поиска пакета через `npm search [query]`

`keywords` — массив с ключевыми словами. Используется для поиска пакета через `npm search [query]

> [!WARNING] Если дистрибуция через npm не нужна, можно обезопасить себя, указав свойство `private: true`

Прочие поля:

`main` — путь к entry point, то есть файлу, который запускает приложение (например, `src/main.js`)

`scripts` — объект для коротких команд. Команды запускаются через `npm run [command]` и выполняют код, указанный в значении соответствующего ключа 

`engines` — объект с указанием версий Node, NPM, yarn, необходимых для работы

`author` — информация об авторе. Может быть в одном из двух форматов:
- строкой типа `Your Name <email> (http://website)`, где еmail и website необязательны
- объектом с ключами `name`, `email` и `url`

`repository` — адрес репозитория, может быть двух форматов:
- строкой с префиксом, указывающим на платформу: `github:apalevich/Tech_Cheat-Sheet`
- объектом с ключами `type` (git, svn) и `url`

`bugs` — объект с контактами для сбора информации о багах. Может содержать одно или оба свойства: `url` для ссылки на баг-трекер и `email` для адреса почты

`homepage` — Ссылка на сайт проекта строкой

и другие

### Зависимости

Есть также свойства `dependencies` и `devDependencies`, в которых ключ объекта указывает имя пакет, а значение — версию.

Для указания относительной версии используются символы:
- ~ позволяет установить последний патч
- ^ позволяет установить последнюю минорную версию
- > и < позволяют установить версию выше или ниже указанной
- >= и <= позволяют указать минимальную и максимальную версию
- * или latest позволяет установить последнюю версию
Условия можно комбинировать, например: `fancy-package: 1.0.0 || >=1.1.0 <1.2.0` — версию 1.0 или 1.1-1.2, если доступна

Разница между `dependencies` и `devDependencies` в том, что вторые — используются только при разработке (например, инструменты тестирования) и не будут включены в сборку для продакшна. Например: webpack, Babel, cypress. 

Для установки пакетов нужно запустить `npm install`. Важно понимать, что у каждого пакета могут быть свои зависимости, а у них — свои, и так далее. Так что по этой команде будут установлены зависимости самого пакета, потом все зависимости его зависимостей, и так далее.

> [!INFO] Просмотреть дерево зависимостей проекта с их версиями можно по команде `npm list`

После установки генерируется файл `package-lock.json`, который фиксирует установленные версии пакетов и их источники. Это помогает убедиться, что в проекте используются идентичные пакеты, поэтому файл `package-lock.json` должен быть помещён в репозиторий. 

# Внешние ресурсы
Статья — [Best practices for creating a modern npm package with security in mind(2022)](https://snyk.io/blog/best-practices-create-modern-npm-package)
