Node.js — это среда, которая позволяет запускать код на языке JavaScript на сервере или компьютере.

Преимущества:
- Скорость — до 2 раз быстрее C или Java
- JavaScript — позволяет писать бэкенд и серверные приложения на знакомом языке
- Асинхронность — достигается аналогично браузеру, через колбэки и события
- Множество библиотек — официальный реестр NPM содержит более 500 тысяч пакетов + прочие источники

# Инструменты
Node — сама среда выполнения JavaScript-кода

V8 — движок обработки кода внутри Node. Аналогичный используется в Chrome и Electron (но не в других браузерах). Он написан на C++ и имеет открытый исходный код.

> [!INFO] Несмотря на то, что JS изначально был интерпретируемым языком, с 2009 года движки стали его компилировать для лучшей скорости выполнения. V8 использует механизм компиляции Just-In-Time (JIT)

ECMAScript (ES) — это стандарт языка JavaScript. Он имеет различные версии, в которых вводятся новый синтаксис и прочие инструменты

NPM — менеджер пакетов и библиотек для Node

NVM — менеджер версий, который позволяет запускать различные версии Node (полезно для тестирования)

# Отличия от JS в браузере

Главное отличие — в Node нет привычных нам браузерных API: DOM, window, document и прочих Web Platform API. Зато есть свои API, как из внешних модулей, так и из стандартной бибилиотеки (например, дающие доступ к файловой системе).

Другое отличие — контроль над тем, в какой среде будет запускаться ваш код, какие версии Node и библиотек использовать и т.п. Это означает, что мы можем писать на любой версии ES без использования инструментов типа Babel.

Наконец, Node использует систему модулей CommonJS, а браузеры — ES модули. Практически это означает, что в Node мы используем `require()` вместо `import`.

## Интерактивный режим

Интерактивный режим Node называется REPL. Он доступен по команде `node` в терминале. Имеет функцию автодополнения через tab

Глобальные переменные доступны в объекте `global`

Результат последней операции доступен в переменной `_`

Также есть специальные команды, которые начинаются с точки:
- `.help` — показывает справку
- `.editor` — позволяет использовать Enter для переноса строки, запуск по Ctrl-D
- `.break` — сброс многострочной команды
- `.clear` — удаляет контекст
- `.load` — загружает файл по пути, относительно текущей директории
- `.save` <имя> — сохраняет сессию в файл с именем
- `.exit` — выход из интерпретатора

# API и стандартная библиотека

## `process`
Это стандартный модуль, который не требует импортирования и позволяет выполнять основные операции с приложением:

```js
// Доступ к переменным окружения
process.env.NODE_ENV

// Доступ к аргументам вызова из командной строки
process.argv // приходят в виде "key=value", что требует парсинга

// Завершение приложения
process.exit() // Экстренное завершение
process.exitCode = 1 // Установка статуса для завершения
process.on('SIGTERM', () => { ... }) // Корректное завершение процессы
process.kill(process.pid, 'SIGTERM') // Завершение другого приложения
```

> [!INFO] SIGRTERM и SIGKILL являются сигналами низкоуровневой системы POSIX

## `console`
Очень похож на `console` в браузере, но объекты выводятся как строки. В остальном отличий не замечено.

Логирование позволяет указывать тип переменной для интерпретации:
- `%s` как строку
- `%d` или `%i` как целое число
- `%f` как дробное число
- `%O` как объект

```js
// Логирование с интерпретацией

console.log('My %s has %d years', 'cat', 2)
// My cat has 2 years
console.log('My %d has %f years', 'cat', 2.5)
// My NaN has 2.5 years

// Подсчёт одинаковых элементов

['orange', 'orange', 99].forEach(console.count)
// orange: 1;
// orange: 2;
// 99: 1;
console.count('orange')
// orange: 3
})

// Замер времени

console.time('timerName')
doSomething()
console.timeEnd('timerName')
```

## `readline`
Стандартный модуль, который позволяет получать данные ввода из потока данных. Например, вот как он работает с потоком `process.stdin` чтобы получить пользовательский ввод с клавиатуры:

```js
const readline = require('readline')
.createInterface({
	input: process.stdin,
	output: process.stdout
})

readline.question('Who are you?', (answer) => {
	console.log(`Hi ${answer}!`);
	readline.close()
})
```

Существуют альтеративные пакеты для обработки ввода, которые позволяют скрывать пароль, делать чекбоксы и много другое. Например, `Inquirer.js`.

# Импорты и экспорты

По умолчанию объекты и переменные приватны, но их можно сделать доступными для импорта в другие файлы двумя способами:

```js
const data = { meaning: 42 }

// 1 — для экспорта объекта
module.exports = data

const data = require('./data')

// 2 — для экспорта свойств
exports.data = data

const items = require('./items').data
```

# Другие статьи
[NPM package](NPM%20package.md)

# Внешние ресурсы
Официальный сайт — [https://nodejs.org/en/download/](https://nodejs.org/en/download/)
Книга The Node.js Handbook — [Flavio Copes](https://flaviocopes.com)